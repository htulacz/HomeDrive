<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Menadżer Plików</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #fileList { margin-top: 20px; }
        .file-item { padding: 10px; border-bottom: 1px solid #ddd; }
        .file-item a { text-decoration: none; color: #333; }
    </style>
</head>
<body>

    <h1>Menadżer Plików</h1>

    <!-- Formularz dodawania plików -->
    <h3>Dodaj zdjęcie</h3>
    <form id="uploadForm">
        <input type="file" id="fileInput">
        <button type="submit">Prześlij</button>
    </form>

    <!-- Formularz dodawania katalogu -->
    <h3>Dodaj katalog</h3>
    <form id="folderForm">
        <input type="text" id="folderName" placeholder="Nazwa katalogu">
        <button type="submit">Utwórz katalog</button>
    </form>

    <!-- Lista plików -->
    <h3>Zawartość folderu</h3>
    <div id="fileList"></div>

    <script>
        const apiUrl = "http://localhost:8080";

        // Funkcja pobierania plików
        async function fetchFiles() {
            const response = await fetch(`${apiUrl}/list/`);
            const data = await response.json();
            const fileList = document.getElementById("fileList");
            fileList.innerHTML = "";

            data.files.forEach(file => {
                const item = document.createElement("div");
                item.classList.add("file-item");
                item.innerHTML = file.isDir ? 
                    `<a href="#" onclick="openFolder('${file.name}')">${file.name}/</a>` : 
                    `<a href="${apiUrl}/uploads/${file.name}" target="_blank">${file.name}</a>`;
                fileList.appendChild(item);
            });
        }

        // Przesyłanie pliku
        document.getElementById("uploadForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById("fileInput").files[0];
            if (!fileInput) return;

            const formData = new FormData();
            formData.append("file", fileInput);

            await fetch(`${apiUrl}/upload/`, { method: "POST", body: formData });
            fetchFiles();
        });

        // Tworzenie katalogu
        document.getElementById("folderForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const folderName = document.getElementById("folderName").value;
            if (!folderName) return;

            await fetch(`${apiUrl}/makeDirectory/`, {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `name=${folderName}`
            });
            fetchFiles();
        });

        // Otwieranie katalogu (nawigacja)
        function openFolder(folder) {
            fetchFiles(folder);
        }

        // Wczytanie plików na start
        fetchFiles();
    </script>

</body>
</html>
